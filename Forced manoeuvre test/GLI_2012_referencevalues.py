# -*- coding: utf-8 -*-
"""
Created on Tue Sep 30 15:04:42 2025

@author: Tejaswini
"""

import pandas as pd
import numpy as np
import math
from typing import Dict
from scipy.interpolate import interp1d

# Ages from 3 to 24.75 have different mspline and sspline data
ages = np.array([3, 3.25, 3.5, 3.75, 4, 4.25, 4.5, 4.75, 5, 5.25, 5.5, 5.75, 6, 6.25, 6.5, 6.75, 7, 7.25, 7.5, 7.75, 8, 8.25, 8.5, 8.75, 9, 9.25, 9.5, 9.75, 10, 10.25, 10.5, 10.75, 11, 11.25, 11.5, 11.75, 12, 12.25, 12.5, 12.75, 13, 13.25, 13.5, 13.75, 14, 14.25, 14.5, 14.75, 15, 15.25, 15.5, 15.75, 16, 16.25, 16.5, 16.75, 17, 17.25, 17.5, 17.75, 18, 18.25, 18.5, 18.75, 19, 19.25, 19.5, 19.75, 20, 20.25, 20.5, 20.75, 21, 21.25, 21.5, 21.75, 22, 22.25, 22.5, 22.75, 23, 23.25, 23.5, 23.75, 24, 24.25, 24.5, 24.75,
                 25,25.25,25.5,25.75,26,26.25,26.5,26.75,27,27.25,27.5,27.75,28,28.25,28.5,28.75,29,29.25,29.5,29.75,30,30.25,30.5,30.75,31,31.25,31.5,31.75,32,32.25,32.5,32.75,33,33.25,33.5,33.75,34,34.25,34.5,34.75,35,35.25,35.5,35.75,36,36.25,36.5,36.75,37,37.25,37.5,37.75,38,38.25,38.5,38.75,39,39.25,39.5,39.75,40,40.25,40.5,40.75,41,41.25,41.5,41.75,42,42.25,42.5,42.75,43,43.25,43.5,43.75,44,44.25,44.5,44.75,45,45.25,45.5,45.75,46,46.25,46.5,46.75,47,47.25,47.5,47.75,48,48.25,48.5,48.75,49,49.25,49.5,49.75,
                 50,50.25,50.5,50.75,51,51.25,51.5,51.75,52,52.25,52.5,52.75,53,53.25,53.5,53.75,54,54.25,54.5,54.75,55,55.25,55.5,55.75,56,56.25,56.5,56.75,57,57.25,57.5,57.75,58,58.25,58.5,58.75,59,59.25,59.5,59.75,60,60.25,60.5,60.75,61,61.25,61.5,61.75,62,62.25,62.5,62.75,63,63.25,63.5,63.75,64,64.25,64.5,64.75,65,65.25,65.5,65.75,66,66.25,66.5,66.75,67,67.25,67.5,67.75,68,68.25,68.5,68.75,69,69.25,69.5,69.75,70,70.25,70.5,70.75,71,71.25,71.5,71.75,72,72.25,72.5,72.75,73,73.25,73.5,73.75,74,74.25,74.5,74.75,
                 75,75.25,75.5,75.75,76,76.25,76.5,76.75,77,77.25,77.5,77.75,78,78.25,78.5,78.75,79,79.25,79.5,79.75,80,80.25,80.5,80.75,81,81.25,81.5,81.75,82,82.25,82.5,82.75,83,83.25,83.5,83.75,84,84.25,84.5,84.75,85,85.25,85.5,85.75,86,86.25,86.5,86.75,87,87.25,87.5,87.75,88,88.25,88.5,88.75,89,89.25,89.5,89.75,90,90.25,90.5,90.75,91,91.25,91.5,91.75,92,92.25,92.5,92.75,93,93.25,93.5,93.75,94,94.25,94.5,94.75,95])

mspline_fev1_males = np.array([-0.1133,-0.1073,-0.1011,-0.0951,-0.0893,-0.0841,-0.0799,-0.0769,-0.0752,-0.0750,-0.0758,-0.0771,-0.0787,-0.0803,-0.0816,-0.0823,-0.0822,-0.0815,-0.0804,-0.0792,-0.0778,-0.0763,-0.0745,-0.0721,-0.0691,-0.0658,-0.0622,-0.0586,-0.0549,-0.0513,-0.0476,-0.0437,-0.0395,-0.0350,-0.0299,-0.0241,-0.0176,-0.0101,-0.0019,0.0071,0.0169,0.0274,0.0384,0.0497,0.0612,0.0728,0.0844,0.0958,0.1068,0.1175,0.1276,0.1371,0.1460,0.1542,0.1616,0.1684,0.1744,0.1798,0.1845,0.1887,0.1924,0.1956,0.1984,0.2008,0.2029,0.2046,0.2060,0.2072,0.2081,0.2087,0.2090,0.2092,0.2091,0.2089,0.2084,0.2079,0.2071,0.2063,0.2053,0.2042,0.2030,0.2016,0.2002,0.1987,0.1970,0.1954,0.1936,0.1918,
                               0.1899,0.1880,0.1861,0.1841,0.1821,0.1801,0.1781,0.1760,0.1739,0.1718,0.1697,0.1677,0.1656,0.1635,0.1615,0.1594,0.1574,0.1554,0.1534,0.1514,0.1495,0.1475,0.1455,0.1436,0.1417,0.1397,0.1378,0.1359,0.1340,0.1321,0.1302,0.1283,0.1265,0.1246,0.1227,0.1209,0.1190,0.1172,0.1153,0.1135,0.1116,0.1097,0.1078,0.1059,0.1040,0.1021,0.1001,0.0982,0.0962,0.0943,0.0923,0.0903,0.0883,0.0863,0.0843,0.0823,0.0803,0.0782,0.0762,0.0742,0.0721,0.0700,0.0680,0.0659,0.0638,0.0617,0.0596,0.0575,0.0554,0.0533,0.0511,0.0490,0.0469,0.0448,0.0427,0.0406,0.0386,0.0365,0.0344,0.0323,0.0302,0.0281,0.0261,0.0240,0.0219,0.0198,0.0177,0.0156,0.0135,0.0114,0.0093,0.0072,0.0050,0.0029,
                               0.0007,-0.0015,-0.0036,-0.0058,-0.0080,-0.0103,-0.0125,-0.0147,-0.0170,-0.0193,-0.0216,-0.0239,-0.0262,-0.0285,-0.0309,-0.0332,-0.0356,-0.0380,-0.0404,-0.0428,-0.0453,-0.0478,-0.0502,-0.0527,-0.0552,-0.0578,-0.0603,-0.0629,-0.0654,-0.0680,-0.0706,-0.0732,-0.0759,-0.0785,-0.0812,-0.0839,-0.0866,-0.0893,-0.0920,-0.0947,-0.0975,-0.1002,-0.1030,-0.1058,-0.1086,-0.1114,-0.1143,-0.1171,-0.1199,-0.1228,-0.1257,-0.1286,-0.1315,-0.1344,-0.1373,-0.1402,-0.1431,-0.1461,-0.1490,-0.1519,-0.1549,-0.1578,-0.1608,-0.1638,-0.1667,-0.1697,-0.1727,-0.1757,-0.1786,-0.1816,-0.1846,-0.1876,-0.1906,-0.1936,-0.1966,-0.1996,-0.2026,-0.2056,-0.2086,-0.2116,-0.2147,-0.2177,-0.2207,
                               -0.2237,-0.2267,-0.2298,-0.2328,-0.2358,-0.2388,-0.2418,-0.2449,-0.2479,-0.2509,-0.2539,-0.2569,-0.2599,-0.2630,-0.2660,-0.2690,-0.2720,-0.2750,-0.2780,-0.2810,-0.2840,-0.2869,-0.2899,-0.2929,-0.2959,-0.2989,-0.3018,-0.3048,-0.3077,-0.3107,-0.3136,-0.3166,-0.3195,-0.3224,-0.3253,-0.3282,-0.3311,-0.3340,-0.3369,-0.3398,-0.3427,-0.3455,-0.3484,-0.3512,-0.3541,-0.3569,-0.3597,-0.3625,-0.3654,-0.3682,-0.3709,-0.3737,-0.3765,-0.3793,-0.3820,-0.3848,-0.3875,-0.3903,-0.3930,-0.3957,-0.3984,-0.4011,-0.4038,-0.4065,-0.4092,-0.4119,-0.4145,-0.4172,-0.4198,-0.4225,-0.4251,-0.4277,-0.4303,-0.4329,-0.4355,-0.4381,-0.4407,-0.4433,-0.4459,-0.4484,-0.4510,-0.4536,-0.4561,
                               -0.4586,-0.4612,-0.4637,-0.4662,-0.4687,-0.4712,-0.4737,-0.4762,-0.4787,-0.4811,-0.4836,-0.4861,-0.4885,-0.4910,-0.4934,-0.4959,-0.4983,-0.5007,-0.5031,-0.5055,-0.5079])

sspline_fev1_males = np.array([0.2143,0.2043,0.1954,0.1872,0.1794,0.1721,0.1653,0.1592,0.1535,0.1479,0.1421,0.1356,0.1285,0.1205,0.1115,0.1016,0.0912,0.0801,0.0685,0.0565,0.0439,0.0308,0.0174,0.0039,-0.0092,-0.0210,-0.0313,-0.0397,-0.0461,-0.0504,-0.0528,-0.0535,-0.0525,-0.0503,-0.0472,-0.0432,-0.0387,-0.0339,-0.0290,-0.0243,-0.0199,-0.0162,-0.0130,-0.0107,-0.0091,-0.0083,-0.0084,-0.0092,-0.0108,-0.0131,-0.0160,-0.0195,-0.0234,-0.0278,-0.0324,-0.0372,-0.0421,-0.0471,-0.0520,-0.0568,-0.0614,-0.0659,-0.0702,-0.0743,-0.0781,-0.0816,-0.0848,-0.0876,-0.0901,-0.0922,-0.0940,-0.0954,-0.0965,-0.0973,-0.0978,-0.0981,-0.0980,-0.0977,-0.0972,-0.0965,-0.0956,-0.0945,-0.0933,-0.0919,-0.0905,-0.0891,-0.0875,-0.0860,
                               -0.0844,-0.0828,-0.0813,-0.0798,-0.0783,-0.0769,-0.0755,-0.0742,-0.0729,-0.0717,-0.0706,-0.0696,-0.0686,-0.0677,-0.0668,-0.0660,-0.0652,-0.0645,-0.0638,-0.0631,-0.0625,-0.0619,-0.0613,-0.0608,-0.0603,-0.0598,-0.0593,-0.0589,-0.0585,-0.0581,-0.0578,-0.0575,-0.0572,-0.0570,-0.0568,-0.0567,-0.0566,-0.0566,-0.0566,-0.0567,-0.0568,-0.0569,-0.0571,-0.0573,-0.0575,-0.0577,-0.0579,-0.0582,-0.0584,-0.0586,-0.0588,-0.0590,-0.0591,-0.0593,-0.0594,-0.0595,-0.0596,-0.0596,-0.0597,-0.0597,-0.0596,-0.0596,-0.0595,-0.0595,-0.0593,-0.0592,-0.0590,-0.0588,-0.0585,-0.0582,-0.0579,-0.0575,-0.0570,-0.0566,-0.0560,-0.0554,-0.0548,-0.0541,-0.0534,-0.0526,-0.0517,-0.0508,-0.0499,-0.0489,-0.0478,
                               -0.0467,-0.0455,-0.0443,-0.0431,-0.0417,-0.0404,-0.0389,-0.0374,-0.0359,-0.0344,-0.0327,-0.0311,-0.0294,-0.0276,-0.0258,-0.0240,-0.0222,-0.0203,-0.0183,-0.0164,-0.0144,-0.0124,-0.0103,-0.0082,-0.0061,-0.0040,-0.0018,0.0003,0.0025,0.0047,0.0070,0.0092,0.0115,0.0137,0.0160,0.0183,0.0206,0.0229,0.0253,0.0276,0.0300,0.0324,0.0348,0.0372,0.0396,0.0420,0.0444,0.0469,0.0494,0.0519,0.0544,0.0569,0.0594,0.0620,0.0645,0.0671,0.0696,0.0722,0.0748,0.0774,0.0800,0.0826,0.0853,0.0879,0.0905,0.0932,0.0958,0.0985,0.1011,0.1038,0.1064,0.1091,0.1117,0.1143,0.1170,0.1196,0.1222,0.1249,0.1275,0.1301,0.1327,0.1352,0.1378,0.1404,0.1429,0.1454,0.1479,0.1504,0.1529,0.1554,0.1578,0.1603,0.1627,0.1651,
                               0.1675,0.1698,0.1722,0.1745,0.1769,0.1792,0.1815,0.1837,0.1860,0.1882,0.1905,0.1927,0.1949,0.1971,0.1993,0.2014,0.2036,0.2057,0.2078,0.2099,0.2120,0.2141,0.2162,0.2182,0.2203,0.2223,0.2243,0.2264,0.2284,0.2304,0.2324,0.2343,0.2363,0.2383,0.2403,0.2422,0.2442,0.2461,0.2480,0.2499,0.2519,0.2538,0.2557,0.2576,0.2595,0.2614,0.2633,0.2651,0.2670,0.2689,0.2707,0.2726,0.2744,0.2763,0.2781,0.2800,0.2818,0.2836,0.2854,0.2873,0.2891,0.2909,0.2927,0.2945,0.2963,0.2980,0.2998,0.3016,0.3034,0.3051,0.3069,0.3087,0.3104,0.3122,0.3139,0.3156,0.3174,0.3191,0.3208,0.3225,0.3243,0.3260,0.3277,0.3294,0.3311,0.3327,0.3344,0.3361,0.3378,0.3395,0.3411,0.3428,0.3444,0.3461,0.3477,0.3494,0.3510,0.3527,
                               0.3543,0.3559,0.3575,0.3592])

lspline_fev1_males = np.zeros(369)

mspline_fev1_females = np.array([-0.2311,-0.2170,-0.2040,-0.1922,-0.1817,-0.1727,-0.1651,-0.1592,-0.1548,-0.1518,-0.1494,-0.1474,-0.1452,-0.1426,-0.1393,-0.1354,-0.1310,-0.1264,-0.1217,-0.1171,-0.1125,-0.1076,-0.1022,-0.0963,-0.0897,-0.0825,-0.0747,-0.0663,-0.0573,-0.0479,-0.0380,-0.0278,-0.0172,-0.0063,0.0048,0.0161,0.0274,0.0386,0.0496,0.0604,0.0709,0.0810,0.0907,0.0999,0.1086,0.1168,0.1244,0.1315,0.1379,0.1438,0.1492,0.1540,0.1583,0.1621,0.1655,0.1684,0.1711,0.1733,0.1753,0.1770,0.1785,0.1797,0.1808,0.1816,0.1823,0.1829,0.1833,0.1837,0.1839,0.1841,0.1842,0.1842,0.1841,0.1840,0.1838,0.1835,0.1832,0.1828,0.1823,0.1818,0.1812,0.1806,0.1799,0.1792,0.1785,0.1777,0.1769,0.1761])
sspline_fev1_females = np.array([0.3351,0.3098,0.2862,0.2643,0.2439,0.2248,0.2071,0.1905,0.1749,0.1602,0.1464,0.1333,0.1208,0.1091,0.0981,0.0877,0.0780,0.0690,0.0605,0.0526,0.0452,0.0383,0.0319,0.0260,0.0206,0.0157,0.0112,0.0072,0.0037,0.0004,-0.0025,-0.0052,-0.0076,-0.0099,-0.0120,-0.0140,-0.0160,-0.0178,-0.0197,-0.0215,-0.0233,-0.0251,-0.0269,-0.0287,-0.0305,-0.0322,-0.0339,-0.0356,-0.0373,-0.0390,-0.0406,-0.0422,-0.0437,-0.0452,-0.0467,-0.0481,-0.0495,-0.0509,-0.0522,-0.0534,-0.0546,-0.0558,-0.0569,-0.0579,-0.0590,-0.0600,-0.0609,-0.0618,-0.0627,-0.0636,-0.0644,-0.0652,-0.0660,-0.0668,-0.0676,-0.0684,-0.0691,-0.0699,-0.0707,-0.0714,-0.0722,-0.0729,-0.0736,-0.0744,-0.0751,-0.0758,-0.0766,-0.0773])

lspline_fev1_females = np.zeros(88)

lspline_fvc_males = np.zeros(88)

mspline_fvc_males = np.array([-0.0938,-0.0888,-0.0836,-0.0783,-0.0731,-0.0683,-0.0642,-0.0611,-0.0589,-0.0578,-0.0576,-0.0581,-0.0591,-0.0605,-0.0618,-0.0627,-0.0632,-0.0633,-0.0631,-0.0628,-0.0622,-0.0613,-0.0598,-0.0576,-0.0547,-0.0515,-0.0482,-0.0449,-0.0418,-0.0389,-0.0361,-0.0334,-0.0308,-0.0280,-0.0250,-0.0217,-0.0178,-0.0134,-0.0083,-0.0026,0.0038,0.0108,0.0184,0.0263,0.0346,0.0431,0.0518,0.0606,0.0693,0.0779,0.0862,0.0943,0.1020,0.1094,0.1163,0.1227,0.1287,0.1342,0.1392,0.1437,0.1478,0.1515,0.1548,0.1578,0.1603,0.1625,0.1644,0.1659,0.1672,0.1681,0.1689,0.1694,0.1697,0.1698,0.1698,0.1696,0.1692,0.1687,0.1681,0.1674,0.1665,0.1656,0.1646,0.1635,0.1623,0.1611,0.1598,0.1585])
                             
sspline_fvc_males = np.array([0.2986,0.2785,0.2598,0.2425,0.2263,0.2109,0.1963,0.1824,0.1691,0.1562,0.1439,0.1318,0.1202,0.1088,0.0978,0.0871,0.0766,0.0665,0.0567,0.0472,0.0381,0.0292,0.0207,0.0126,0.0048,-0.0024,-0.0092,-0.0155,-0.0211,-0.0262,-0.0308,-0.0348,-0.0383,-0.0414,-0.0441,-0.0464,-0.0484,-0.0502,-0.0517,-0.0530,-0.0542,-0.0553,-0.0563,-0.0571,-0.0580,-0.0588,-0.0596,-0.0603,-0.0611,-0.0618,-0.0626,-0.0634,-0.0641,-0.0649,-0.0657,-0.0665,-0.0673,-0.0682,-0.0690,-0.0698,-0.0706,-0.0714,-0.0722,-0.0730,-0.0738,-0.0746,-0.0753,-0.0760,-0.0767,-0.0773,-0.0779,-0.0785,-0.0790,-0.0795,-0.0800,-0.0804,-0.0807,-0.0811,-0.0814,-0.0816,-0.0818,-0.0820,-0.0821,-0.0822,-0.0823,-0.0823,-0.0823,-0.0823])

lspline_fvc_females = np.zeros(88)

mspline_fvc_females = np.array([-0.1940,-0.1824,-0.1717,-0.1619,-0.1530,-0.1451,-0.1382,-0.1324,-0.1276,-0.1238,-0.1206,-0.1179,-0.1153,-0.1128,-0.1102,-0.1074,-0.1045,-0.1014,-0.0983,-0.0952,-0.0918,-0.0881,-0.0838,-0.0787,-0.0731,-0.0669,-0.0604,-0.0534,-0.0461,-0.0386,-0.0310,-0.0232,-0.0154,-0.0074,0.0006,0.0086,0.0166,0.0244,0.0322,0.0399,0.0473,0.0546,0.0616,0.0684,0.0749,0.0811,0.0870,0.0925,0.0977,0.1026,0.1071,0.1113,0.1151,0.1186,0.1217,0.1247,0.1273,0.1297,0.1318,0.1338,0.1355,0.1370,0.1384,0.1396,0.1406,0.1415,0.1423,0.1430,0.1436,0.1442,0.1446,0.1450,0.1453,0.1456,0.1458,0.1459,0.1460,0.1461,0.1461,0.1460,0.1459,0.1457,0.1455,0.1452,0.1449,0.1446,0.1443,0.1440])

sspline_fvc_females = np.array([0.3694,0.3431,0.3186,0.2958,0.2744,0.2542,0.2352,0.2170,0.1995,0.1827,0.1664,0.1507,0.1355,0.1209,0.1069,0.0938,0.0815,0.0700,0.0592,0.0491,0.0396,0.0307,0.0223,0.0145,0.0074,0.0010,-0.0046,-0.0095,-0.0137,-0.0173,-0.0203,-0.0227,-0.0246,-0.0261,-0.0273,-0.0282,-0.0289,-0.0294,-0.0298,-0.0301,-0.0304,-0.0306,-0.0307,-0.0308,-0.0310,-0.0311,-0.0312,-0.0314,-0.0316,-0.0318,-0.0320,-0.0323,-0.0326,-0.0329,-0.0332,-0.0336,-0.0339,-0.0343,-0.0346,-0.0350,-0.0354,-0.0358,-0.0362,-0.0366,-0.0371,-0.0375,-0.0380,-0.0385,-0.0391,-0.0396,-0.0402,-0.0408,-0.0414,-0.0421,-0.0428,-0.0435,-0.0442,-0.0450,-0.0458,-0.0466,-0.0474,-0.0483,-0.0492,-0.0501,-0.0511,-0.0520,-0.0530,-0.0540])

lspline_fev1fvc_males = np.array([1.3876,1.2621,1.1460,1.0382,0.9377,0.8437,0.7556,0.6729,0.5953,0.5227,0.4549,0.3918,0.3331,0.2788,0.2285,0.1822,0.1397,0.1008,0.0651,0.0324,0.0026,-0.0244,-0.0490,-0.0712,-0.0912,-0.1092,-0.1254,-0.1400,-0.1533,-0.1653,-0.1762,-0.1862,-0.1953,-0.2036,-0.2112,-0.2180,-0.2240,-0.2294,-0.2340,-0.2378,-0.2410,-0.2434,-0.2451,-0.2462,-0.2466,-0.2465,-0.2457,-0.2445,-0.2427,-0.2405,-0.2378,-0.2348,-0.2313,-0.2275,-0.2234,-0.2189,-0.2142,-0.2091,-0.2039,-0.1983,-0.1926,-0.1867,-0.1805,-0.1742,-0.1678,-0.1612,-0.1544,-0.1476,-0.1406,-0.1335,-0.1264,-0.1192,-0.1119,-0.1046,-0.0973,-0.0900,-0.0826,-0.0753,-0.0679,-0.0606,-0.0533,-0.0460,-0.0388,-0.0316,-0.0244,-0.0173,-0.0103,-0.0033])

mspline_fev1fvc_males = np.array([-0.0221,-0.0191,-0.0167,-0.0147,-0.0132,-0.0122,-0.0117,-0.0119,-0.0125,-0.0136,-0.0148,-0.0159,-0.0167,-0.0171,-0.0173,-0.0172,-0.0169,-0.0163,-0.0156,-0.0148,-0.0140,-0.0134,-0.0131,-0.0132,-0.0135,-0.0139,-0.0142,-0.0143,-0.0143,-0.0139,-0.0132,-0.0122,-0.0108,-0.0091,-0.0070,-0.0047,-0.0021,0.0006,0.0035,0.0065,0.0095,0.0126,0.0156,0.0186,0.0215,0.0242,0.0268,0.0293,0.0315,0.0336,0.0354,0.0370,0.0385,0.0396,0.0406,0.0414,0.0421,0.0425,0.0429,0.0431,0.0432,0.0432,0.0431,0.0429,0.0427,0.0424,0.0421,0.0418,0.0414,0.0410,0.0406,0.0401,0.0397,0.0392,0.0387,0.0382,0.0377,0.0372,0.0367,0.0362,0.0357,0.0351,0.0346,0.0341,0.0335,0.0330,0.0325,0.0319])

sspline_fev1fvc_males = np.array([-0.0832,-0.0616,-0.0420,-0.0242,-0.0085,0.0047,0.0153,0.0232,0.0287,0.0323,0.0342,0.0351,0.0350,0.0345,0.0339,0.0332,0.0327,0.0323,0.0318,0.0310,0.0298,0.0278,0.0249,0.0208,0.0159,0.0104,0.0048,-0.0007,-0.0058,-0.0103,-0.0143,-0.0177,-0.0204,-0.0223,-0.0235,-0.0239,-0.0238,-0.0230,-0.0217,-0.0199,-0.0177,-0.0153,-0.0126,-0.0098,-0.0068,-0.0038,-0.0007,0.0024,0.0054,0.0082,0.0110,0.0135,0.0159,0.0180,0.0200,0.0218,0.0233,0.0247,0.0258,0.0268,0.0275,0.0280,0.0283,0.0285,0.0284,0.0282,0.0278,0.0272,0.0265,0.0257,0.0248,0.0238,0.0226,0.0214,0.0200,0.0186,0.0171,0.0155,0.0138,0.0120,0.0102,0.0082,0.0062,0.0041,0.0020,-0.0003,-0.0026,-0.0049])

lspline_fev1fvc_females = np.zeros(88)

mspline_fev1fvc_females = np.array([-0.0443,-0.0397,-0.0356,-0.0318,-0.0286,-0.0261,-0.0244,-0.0235,-0.0233,-0.0237,-0.0244,-0.0252,-0.0259,-0.0262,-0.0260,-0.0253,-0.0243,-0.0230,-0.0215,-0.0200,-0.0185,-0.0172,-0.0161,-0.0152,-0.0145,-0.0137,-0.0129,-0.0119,-0.0106,-0.0091,-0.0073,-0.0052,-0.0029,-0.0004,0.0023,0.0051,0.0080,0.0109,0.0138,0.0167,0.0194,0.0221,0.0245,0.0268,0.0289,0.0309,0.0326,0.0342,0.0355,0.0367,0.0377,0.0386,0.0393,0.0399,0.0403,0.0407,0.0409,0.0411,0.0411,0.0411,0.0411,0.0409,0.0408,0.0406,0.0403,0.0400,0.0396,0.0393,0.0389,0.0384,0.0380,0.0375,0.0370,0.0366,0.0360,0.0355,0.0350,0.0345,0.0340,0.0334,0.0329,0.0324,0.0319,0.0314,0.0309,0.0304,0.0299,0.0294])

sspline_fev1fvc_females = np.array([0.0305,0.0359,0.0406,0.0447,0.0480,0.0506,0.0523,0.0532,0.0534,0.0528,0.0515,0.0496,0.0473,0.0448,0.0423,0.0399,0.0376,0.0355,0.0334,0.0312,0.0289,0.0265,0.0238,0.0207,0.0175,0.0142,0.0108,0.0076,0.0045,0.0017,-0.0009,-0.0033,-0.0055,-0.0074,-0.0092,-0.0107,-0.0121,-0.0134,-0.0145,-0.0155,-0.0163,-0.0171,-0.0178,-0.0184,-0.0190,-0.0194,-0.0198,-0.0200,-0.0203,-0.0204,-0.0205,-0.0205,-0.0204,-0.0203,-0.0202,-0.0199,-0.0196,-0.0193,-0.0188,-0.0184,-0.0179,-0.0173,-0.0168,-0.0162,-0.0156,-0.0149,-0.0143,-0.0137,-0.0131,-0.0125,-0.0119,-0.0113,-0.0108,-0.0103,-0.0098,-0.0094,-0.0090,-0.0086,-0.0083,-0.0080,-0.0078,-0.0076,-0.0075,-0.0074,-0.0073,-0.0074,-0.0074,-0.0076])

lspline_fef2575_males = np.zeros(349)

mspline_fef2575_males = np.array([-0.3520,-0.3529,-0.3536,-0.3542,-0.3550,-0.3562,-0.3578,-0.3596,-0.3617,-0.3638,-0.3657,-0.3670,-0.3674,-0.3668,-0.3651,-0.3623,-0.3583,-0.3533,-0.3472,-0.3401,-0.3323,-0.3239,-0.3150,-0.3057,-0.2961,-0.2862,-0.2760,-0.2653,-0.2540,-0.2422,-0.2298,-0.2168,-0.2032,-0.1890,-0.1743,-0.1590,-0.1433,-0.1271,-0.1105,-0.0935,-0.0761,-0.0585,-0.0409,-0.0233,-0.0060,0.0110,0.0275,0.0434,0.0588,0.0734,0.0873,0.1004,0.1126,0.1241,0.1348,0.1448,0.1541,0.1626,0.1704,0.1775,0.1840,0.1898,0.1949,0.1994,0.2033,0.2066,0.2095,0.2118,0.2138,0.2153,0.2165,0.2174,0.2180,0.2183,0.2183,0.2182,0.2178,0.2173,0.2166,0.2158,0.2149,0.2138,0.2127,0.2114,0.2101,0.2087,0.2072,0.2057,0.2042,0.2026,0.2009,0.1993,0.1976,0.1959,0.1941,0.1924,0.1907,0.1890,0.1873,0.1856,0.1839,0.1822,0.1805,0.1788,0.1771,0.1754,0.1738,0.1721,0.1705,0.1688,0.1672,0.1656,0.1640,0.1624,0.1608,0.1593,0.1577,0.1562,0.1546,0.1531,0.1516,0.1501,0.1486,0.1471,0.1456,0.1441,0.1425,0.1410,0.1395,0.1380,0.1364,0.1348,0.1333,0.1316,0.1300,0.1284,0.1267,0.1250,0.1233,0.1216,0.1198,0.1180,0.1162,0.1144,0.1125,0.1106,0.1086,0.1067,0.1047,0.1026,0.1006,0.0985,0.0964,0.0942,0.0920,0.0898,0.0875,0.0852,0.0829,0.0806,0.0782,0.0757,0.0733,0.0708,0.0683,0.0658,0.0632,0.0606,0.0579,0.0553,0.0526,0.0498,0.0470,0.0442,0.0414,0.0386,0.0357,0.0327,0.0298,0.0268,0.0238,0.0207,0.0176,0.0145,0.0114,0.0082,0.0050,0.0018,-0.0015,-0.0048,-0.0081,-0.0115,-0.0148,-0.0183,-0.0217,-0.0252,-0.0287,-0.0322,-0.0358,-0.0394,-0.0430,-0.0466,-0.0503,-0.0540,-0.0577,-0.0615,-0.0653,-0.0691,-0.0729,-0.0768,-0.0807,-0.0846,-0.0886,-0.0926,-0.0966,-0.1006,-0.1047,-0.1088,-0.1129,-0.1170,-0.1212,-0.1253,-0.1295,-0.1338,-0.1380,-0.1422,-0.1465,-0.1508,-0.1551,-0.1594,-0.1637,-0.1681,-0.1724,-0.1768,-0.1811,-0.1855,-0.1899,-0.1943,-0.1987,-0.2031,-0.2075,-0.2119,-0.2164,-0.2208,-0.2252,-0.2297,-0.2341,-0.2386,-0.2430,-0.2474,-0.2519,-0.2563,-0.2608,-0.2652,-0.2697,-0.2741,-0.2786,-0.2830,-0.2875,-0.2919,-0.2963,-0.3007,-0.3052,-0.3096,-0.3140,-0.3184,-0.3228,-0.3272,-0.3316,-0.3360,-0.3404,-0.3448,-0.3491,-0.3535,-0.3578,-0.3622,-0.3665,-0.3709,-0.3752,-0.3795,-0.3838,-0.3881,-0.3924,-0.3967,-0.4010,-0.4053,-0.4095,-0.4138,-0.4180,-0.4223,-0.4265,-0.4307,-0.4349,-0.4391,-0.4433,-0.4475,-0.4517,-0.4559,-0.4600,-0.4642,-0.4683,-0.4724,-0.4765,-0.4806,-0.4847,-0.4888,-0.4929,-0.4969,-0.5010,-0.5050,-0.5090,-0.5131,-0.5171,-0.5211,-0.5250,-0.5290,-0.5330,-0.5369,-0.5409,-0.5448,-0.5487,-0.5526,-0.5565,-0.5604,-0.5643,-0.5681,-0.5720,-0.5758,-0.5797,-0.5835,-0.5873,-0.5911,-0.5949,-0.5986,-0.6024,-0.6062,-0.6099,-0.6136,-0.6174,-0.6211,-0.6248,-0.6285,-0.6322,-0.6358,-0.6395,-0.6432,-0.6468,-0.6504,-0.6541])
sspline_fef2575_males = np.array([0.5568,0.5318,0.5084,0.4862,0.4650,0.4446,0.4248,0.4054,0.3863,0.3675,0.3490,0.3307,0.3126,0.2947,0.2770,0.2596,0.2425,0.2258,0.2094,0.1935,0.1780,0.1629,0.1484,0.1345,0.1211,0.1082,0.0960,0.0843,0.0732,0.0626,0.0526,0.0432,0.0343,0.0260,0.0181,0.0107,0.0037,-0.0028,-0.0090,-0.0148,-0.0202,-0.0253,-0.0301,-0.0346,-0.0388,-0.0428,-0.0465,-0.0501,-0.0534,-0.0565,-0.0594,-0.0621,-0.0647,-0.0672,-0.0695,-0.0716,-0.0737,-0.0756,-0.0774,-0.0791,-0.0807,-0.0822,-0.0836,-0.0850,-0.0862,-0.0874,-0.0885,-0.0896,-0.0905,-0.0915,-0.0923,-0.0931,-0.0938,-0.0945,-0.0951,-0.0957,-0.0962,-0.0966,-0.0971,-0.0974,-0.0978,-0.0980,-0.0983,-0.0985,-0.0986,-0.0987,-0.0988,-0.0989,-0.0989,-0.0988,-0.0988,-0.0987,-0.0985,-0.0984,-0.0982,-0.0980,-0.0977,-0.0974,-0.0971,-0.0968,-0.0964,-0.0960,-0.0956,-0.0951,-0.0946,-0.0941,-0.0936,-0.0930,-0.0925,-0.0918,-0.0912,-0.0906,-0.0899,-0.0892,-0.0884,-0.0877,-0.0869,-0.0861,-0.0853,-0.0845,-0.0836,-0.0827,-0.0818,-0.0809,-0.0800,-0.0790,-0.0780,-0.0770,-0.0760,-0.0750,-0.0739,-0.0728,-0.0718,-0.0706,-0.0695,-0.0684,-0.0672,-0.0661,-0.0649,-0.0637,-0.0625,-0.0612,-0.0600,-0.0587,-0.0575,-0.0562,-0.0549,-0.0536,-0.0523,-0.0509,-0.0496,-0.0482,-0.0468,-0.0454,-0.0440,-0.0426,-0.0412,-0.0398,-0.0383,-0.0368,-0.0354,-0.0339,-0.0324,-0.0309,-0.0293,-0.0278,-0.0263,-0.0247,-0.0231,-0.0216,-0.0200,-0.0184,-0.0167,-0.0151,-0.0135,-0.0118,-0.0102,-0.0085,-0.0068,-0.0052,-0.0035,-0.0018,0.0000,0.0017,0.0034,0.0052,0.0069,0.0087,0.0104,0.0122,0.0140,0.0158,0.0176,0.0194,0.0212,0.0231,0.0249,0.0267,0.0286,0.0304,0.0323,0.0342,0.0361,0.0379,0.0398,0.0417,0.0436,0.0456,0.0475,0.0494,0.0513,0.0533,0.0552,0.0572,0.0591,0.0611,0.0630,0.0650,0.0670,0.0690,0.0710,0.0729,0.0749,0.0769,0.0789,0.0809,0.0829,0.0850,0.0870,0.0890,0.0910,0.0930,0.0950,0.0971,0.0991,0.1011,0.1031,0.1051,0.1072,0.1092,0.1112,0.1132,0.1153,0.1173,0.1193,0.1214,0.1234,0.1254,0.1274,0.1294,0.1315,0.1335,0.1355,0.1375,0.1395,0.1415,0.1435,0.1456,0.1476,0.1496,0.1516,0.1536,0.1556,0.1575,0.1595,0.1615,0.1635,0.1655,0.1675,0.1694,0.1714,0.1734,0.1754,0.1773,0.1793,0.1812,0.1832,0.1851,0.1871,0.1890,0.1910,0.1929,0.1948,0.1967,0.1987,0.2006,0.2025,0.2044,0.2063,0.2082,0.2101,0.2120,0.2139,0.2158,0.2177,0.2195,0.2214,0.2233,0.2251,0.2270,0.2288,0.2307,0.2325,0.2344,0.2362,0.2380,0.2399,0.2417,0.2435,0.2453,0.2471,0.2489,0.2507,0.2525,0.2543,0.2561,0.2578,0.2596,0.2614,0.2631,0.2649,0.2666,0.2684,0.2701,0.2719,0.2736,0.2753,0.2771,0.2788,0.2805,0.2822,0.2839,0.2856,0.2873,0.2890,0.2907,0.2924,0.2940,0.2957,0.2974,0.2990,0.3007,0.3023,0.3040,0.3056,0.3073,0.3089,0.3106,0.3122])

lspline_fef2575_females = np.zeros(88)

sspline_fef2575_females = np.array([0.5923,0.5663,0.5421,0.5194,0.4979,0.4776,0.4580,0.4392,0.4210,0.4034,0.3862,0.3695,0.3532,0.3372,0.3216,0.3064,0.2914,0.2768,0.2626,0.2486,0.2349,0.2216,0.2086,0.1958,0.1834,0.1713,0.1596,0.1481,0.1370,0.1263,0.1159,0.1058,0.0961,0.0867,0.0776,0.0689,0.0604,0.0523,0.0444,0.0369,0.0296,0.0225,0.0158,0.0093,0.0030,-0.0031,-0.0089,-0.0146,-0.0200,-0.0252,-0.0302,-0.0350,-0.0397,-0.0442,-0.0485,-0.0526,-0.0566,-0.0605,-0.0641,-0.0677,-0.0711,-0.0743,-0.0774,-0.0804,-0.0833,-0.0860,-0.0886,-0.0911,-0.0935,-0.0958,-0.0979,-0.1000,-0.1020,-0.1039,-0.1056,-0.1073,-0.1089,-0.1104,-0.1119,-0.1132,-0.1145,-0.1157,-0.1168,-0.1179,-0.1189,-0.1198,-0.1206,-0.1214])

mspline_fef2575_females = np.array([-0.6779,-0.6614,-0.6466,-0.6333,-0.6213,-0.6103,-0.6001,-0.5903,-0.5807,-0.5711,-0.5611,-0.5505,-0.5392,-0.5269,-0.5136,-0.4994,-0.4843,-0.4682,-0.4514,-0.4337,-0.4154,-0.3965,-0.3771,-0.3573,-0.3370,-0.3166,-0.2959,-0.2753,-0.2547,-0.2342,-0.2139,-0.1939,-0.1742,-0.1549,-0.1361,-0.1178,-0.1001,-0.0830,-0.0666,-0.0508,-0.0358,-0.0215,-0.0078,0.0051,0.0174,0.0291,0.0401,0.0505,0.0603,0.0695,0.0781,0.0861,0.0936,0.1007,0.1072,0.1133,0.1190,0.1243,0.1293,0.1339,0.1382,0.1421,0.1458,0.1492,0.1523,0.1552,0.1579,0.1604,0.1626,0.1647,0.1666,0.1683,0.1698,0.1712,0.1725,0.1737,0.1747,0.1756,0.1764,0.1771,0.1777,0.1782,0.1787,0.1791,0.1793,0.1796,0.1797,0.1798])

lspline_fef75_males = np.zeros(88)

mspline_fef75_males = np.array([-0.2579,-0.2701,-0.2784,-0.2833,-0.2852,-0.2847,-0.2827,-0.2800,-0.2775,-0.2760,-0.2757,-0.2769,-0.2797,-0.2838,-0.2889,-0.2944,-0.2999,-0.3049,-0.3091,-0.3123,-0.3143,-0.3151,-0.3145,-0.3126,-0.3092,-0.3042,-0.2977,-0.2894,-0.2794,-0.2676,-0.2542,-0.2390,-0.2223,-0.2040,-0.1843,-0.1634,-0.1414,-0.1187,-0.0953,-0.0715,-0.0474,-0.0232,0.0010,0.0251,0.0488,0.0720,0.0944,0.1161,0.1367,0.1563,0.1745,0.1916,0.2074,0.2219,0.2351,0.2471,0.2579,0.2675,0.2760,0.2833,0.2895,0.2948,0.2991,0.3026,0.3054,0.3075,0.3091,0.3101,0.3106,0.3107,0.3104,0.3097,0.3086,0.3073,0.3057,0.3039,0.3018,0.2995,0.2971,0.2944,0.2916,0.2886,0.2855,0.2823,0.2790,0.2756,0.2721,0.2686])

sspline_fef75_males = np.array([0.2991,0.2823,0.2668,0.2523,0.2388,0.2261,0.2141,0.2027,0.1918,0.1813,0.1712,0.1614,0.1519,0.1427,0.1338,0.1252,0.1168,0.1086,0.1007,0.0930,0.0856,0.0783,0.0712,0.0643,0.0576,0.0510,0.0446,0.0384,0.0323,0.0264,0.0207,0.0152,0.0098,0.0046,-0.0004,-0.0053,-0.0100,-0.0145,-0.0189,-0.0232,-0.0273,-0.0313,-0.0351,-0.0388,-0.0423,-0.0458,-0.0491,-0.0522,-0.0552,-0.0581,-0.0609,-0.0636,-0.0661,-0.0685,-0.0708,-0.0730,-0.0751,-0.0771,-0.0790,-0.0807,-0.0824,-0.0840,-0.0855,-0.0869,-0.0882,-0.0894,-0.0905,-0.0916,-0.0926,-0.0935,-0.0943,-0.0950,-0.0957,-0.0963,-0.0969,-0.0973,-0.0978,-0.0981,-0.0984,-0.0986,-0.0988,-0.0989,-0.0990,-0.0990,-0.0990,-0.0989,-0.0987,-0.0985])

lspline_fef75_females = np.array([-0.5235,-0.4811,-0.4420,-0.4056,-0.3718,-0.3403,-0.3110,-0.2836,-0.2582,-0.2345,-0.2125,-0.1922,-0.1734,-0.1560,-0.1399,-0.1250,-0.1112,-0.0984,-0.0866,-0.0757,-0.0657,-0.0565,-0.0480,-0.0402,-0.0330,-0.0264,-0.0203,-0.0147,-0.0094,-0.0045,0.0001,0.0044,0.0084,0.0123,0.0159,0.0194,0.0227,0.0259,0.0289,0.0318,0.0346,0.0373,0.0399,0.0424,0.0448,0.0471,0.0493,0.0514,0.0533,0.0552,0.0570,0.0587,0.0602,0.0617,0.0631,0.0643,0.0655,0.0666,0.0676,0.0685,0.0693,0.0700,0.0707,0.0712,0.0717,0.0721,0.0725,0.0728,0.0730,0.0732,0.0733,0.0734,0.0734,0.0734,0.0734,0.0733,0.0731,0.0729,0.0727,0.0725,0.0722,0.0718,0.0715,0.0711,0.0706,0.0702,0.0697,0.0692])

mspline_fef75_females = np.array([-0.6278,-0.6144,-0.6000,-0.5853,-0.5709,-0.5573,-0.5448,-0.5336,-0.5238,-0.5151,-0.5074,-0.5005,-0.4946,-0.4896,-0.4848,-0.4799,-0.4744,-0.4680,-0.4604,-0.4512,-0.4403,-0.4275,-0.4128,-0.3961,-0.3776,-0.3575,-0.3360,-0.3133,-0.2894,-0.2645,-0.2387,-0.2122,-0.1853,-0.1581,-0.1308,-0.1036,-0.0768,-0.0506,-0.0252,-0.0006,0.0230,0.0454,0.0667,0.0867,0.1055,0.1231,0.1395,0.1548,0.1690,0.1821,0.1942,0.2053,0.2156,0.2250,0.2336,0.2415,0.2489,0.2556,0.2619,0.2677,0.2731,0.2781,0.2828,0.2871,0.2910,0.2946,0.2979,0.3008,0.3034,0.3056,0.3075,0.3091,0.3104,0.3113,0.3120,0.3124,0.3126,0.3125,0.3122,0.3118,0.3112,0.3104,0.3096,0.3086,0.3076,0.3065,0.3053,0.3041])

sspline_fef75_females = np.array([-3.1701,-3.0321,-2.9044,-2.7854,-2.6741,-2.5695,-2.4709,-2.3775,-2.2890,-2.2047,-2.1245,-2.0478,-1.9745,-1.9042,-1.8367,-1.7718,-1.7093,-1.6490,-1.5908,-1.5344,-1.4799,-1.4270,-1.3757,-1.3259,-1.2775,-1.2303,-1.1844,-1.1396,-1.0959,-1.0533,-1.0116,-0.9707,-0.9308,-0.8916,-0.8533,-0.8156,-0.7786,-0.7423,-0.7067,-0.6716,-0.6371,-0.6031,-0.5697,-0.5368,-0.5043,-0.4723,-0.4407,-0.4096,-0.3789,-0.3486,-0.3186,-0.2890,-0.2598,-0.2309,-0.2023,-0.1741,-0.1461,-0.1185,-0.0912,-0.0641,-0.0374,-0.0109,0.0154,0.0413,0.0670,0.0925,0.1177,0.1427,0.1674,0.1919,0.2162,0.2403,0.2641,0.2878,0.3112,0.3345,0.3575,0.3804,0.4030,0.4255,0.4478,0.4699,0.4918,0.5136,0.5352,0.5566,0.5778,0.5989])

def equations(age: float, height: float, ethnicity: str, coefficients: Dict[str, float], z: float = 1.645) -> Dict[str, float]:
    """Calculate GLI 2012 predicted values and LLN/ULN."""
    
    if age <= 0 or height <= 0:
        raise ValueError("age and height must be > 0")
    
    # Ethnicity one-hot encoding
    e = (ethnicity or "").strip().lower()
    AA = 1 if e in ("african american", "aa", "black") else 0
    NEA = 1 if e in ("north east asian", "nea", "northeast asian") else 0
    SEA = 1 if e in ("south east asian", "sea", "southeast asian") else 0
    others = 1 if e in ("others", "other") else 0
    if e in ("caucasian", "white"):
        AA = NEA = SEA = others = 0
    
    # Get spline values
    mspline = coefficients.get('mspline', 0)
    sspline = coefficients.get('sspline', 0)
    lspline = coefficients.get('lspline', 0)
    
    # Calculate L, M, S
    L = coefficients['q0'] + coefficients['q1'] * math.log(age) + lspline
    M = math.exp(coefficients['a0'] + coefficients['a1'] * math.log(height) +
                 coefficients['a2'] * math.log(age) + coefficients['a3'] * AA +
                 coefficients['a4'] * NEA + coefficients['a5'] * SEA +
                 coefficients['a6'] * others + mspline)
    S = math.exp(coefficients['p0'] + coefficients['p1'] * math.log(age) +
                 coefficients['p2'] * AA + coefficients['p3'] * NEA +
                 coefficients['p4'] * SEA + coefficients['p5'] * others + sspline)
    
    # Calculate LLN and ULN
    LLN = math.exp((math.log(1 - z * L * S)) / L + math.log(M))
    ULN = math.exp((math.log(1 + z * L * S)) / L + math.log(M))
    
    return {"M": M, "L": L, "S": S, "LLN": LLN, "ULN": ULN,
            "mspline": mspline, "lspline": lspline, "sspline": sspline}

def fev1_males(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for males."""
    coeffs = {}
    coeffs['mspline'] = float(interp1d(ages, mspline_fev1_males, kind='linear', fill_value='extrapolate')(age))
    coeffs['sspline'] = float(interp1d(ages, sspline_fev1_males, kind='linear', fill_value='extrapolate')(age))
    coeffs['lspline'] = float(interp1d(ages, lspline_fev1_males, kind='linear', fill_value='extrapolate')(age))

    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 0.886600, 'q1': 0.085000,
        'a0': -10.3420, 'a1': 2.2196, 'a2': 0.0574,
        'a3': -0.1589, 'a4': -0.0351, 'a5': -0.0881, 'a6': -0.0708,
        'p0': -2.3268, 'p1': 0.0798, 'p2': 0.1096,
        'p3': -0.3973, 'p4': 0.0327, 'p5': 0.0114
    })
    
    return coeffs

def fev1_females(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fev1_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fev1_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fev1_females, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients; mspline is ms, sspline is ss, lspline is ls
        ms_coeffs = [0.05520, 1.60290, -6.48449, 10.27228, -9.86298, 3.88024]
        ss_coeffs = [-0.0822, 1.41152, -11.27973, 29.46127, -29.56965, 10.44676]
        ls_coeffs = [0.0, 0.0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(2))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 1.1540, 'q1': 0.0,
        'a0': -9.6987, 'a1': 2.1211, 'a2': -0.0270,
        'a3': -0.1484, 'a4': -0.0149, 'a5': -0.1208, 'a6': -0.0708,
        'p0': -2.3765, 'p1': 0.0972, 'p2': 0.1016,
        'p3': -0.0109, 'p4': 0.0733, 'p5': 0.0114
    })
    
    return coeffs

def fvc_males(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fvc_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fvc_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fvc_males, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.3298,-1.1230,2.8110,-5.4811,3.5964,-0.5884]
        ss_coeffs = [-0.0645,0.2070,-3.0606,10.3907,-11.1003,3.9633]
        ls_coeffs = [0.0, 0.0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(2))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 0.9481, 'q1': 0.0,
        'a0': -11.2281, 'a1': 2.4135, 'a2': 0.0865,
        'a3': -0.1684, 'a4': -0.0405, 'a5': -0.1177, 'a6': -0.0825,
        'p0': -2.2963, 'p1': 0.0718, 'p2': 0.0794,
        'p3': -0.46, 'p4': 0.0325, 'p5': -0.0503
    })
    
    return coeffs

def fvc_females(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fvc_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fvc_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fvc_females, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.0745,0.6006,-1.0684,-1.1308,0.9730,0.0643]
        ss_coeffs = [-0.2301,3.7699,-22.4318,51.8219,-49.7845,17.2894]
        ls_coeffs = [0.0, 0.0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(2))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 0.8236, 'q1': 0.0,
        'a0': -10.4030, 'a1': 2.2633, 'a2': 0.0234,
        'a3': -0.1555, 'a4': -0.0262, 'a5': -0.1516, 'a6': -0.0833,
        'p0': -2.3549, 'p1': 0.1017, 'p2': 0.081,
        'p3': -0.1809, 'p4': 0.0459, 'p5': -0.0503
    })
    
    return coeffs

def fev1fvc_males(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fev1fvc_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fev1fvc_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fev1fvc_males, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.1410,-0.8394,2.3953,-3.8845,2.9921,-0.8703]
        ss_coeffs = [-0.0500,3.5373,-25.5356,61.4963,-59.6189,20.6824]
        ls_coeffs = [1.705,-39.280,287.100,-979.700,1818.000,-1908.000,1067.000,-247.700]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(8))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 4.7101, 'q1': -0.6774,
        'a0': 0.7403, 'a1': -0.1595, 'a2': -0.0366,
        'a3': 0.0079, 'a4': 0.0055, 'a5': 0.0283, 'a6': 0.0106,
        'p0': -2.9595, 'p1': 0.1156, 'p2': -0.0381,
        'p3': -0.2227, 'p4': -0.1414, 'p5': -0.0860
    })
    
    return coeffs

def fev1fvc_females(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fev1fvc_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fev1fvc_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fev1fvc_females, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.03044,0.41770,-2.99180,6.71920,-6.54890,2.34390]
        ss_coeffs = [-0.9018,10.6789,-45.8328,86.7310,-73.7466,23.4537]
        ls_coeffs = [0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(1))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 7.032, 'q1': -1.197,
        'a0': 0.5506, 'a1': -0.1078, 'a2': -0.0544,
        'a3': 0.0055, 'a4': 0.0088, 'a5': 0.0285, 'a6': 0.0106,
        'p0': -3.2395, 'p1': 0.1850, 'p2': 0.0307,
        'p3': -0.1640, 'p4': -0.1521, 'p5': -0.0860
    })
    
    return coeffs

def fef2575_males(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEF2575 coefficients for males."""
    coeffs = {}
    
    coeffs['mspline'] = float(interp1d(ages[:349], mspline_fef2575_males, kind='linear', fill_value='extrapolate')(age))
    coeffs['sspline'] = float(interp1d(ages[:349], sspline_fef2575_males, kind='linear', fill_value='extrapolate')(age))
    coeffs['lspline'] = float(interp1d(ages[:349], lspline_fef2575_males, kind='linear', fill_value='extrapolate')(age))

    coeffs.update({
        'q0': 0.4986, 'q1': 0.0,
        'a0': -6.9189, 'a1': 1.6895, 'a2': -0.1425,
        'a3': -0.1384, 'a4': -0.0327, 'a5': -0.0094, 'a6': -0.0531,
      'p0': -2.1034, 'p1': 0.2463, 'p2': 0.1625,
       'p3': -0.1413, 'p4': -0.1039, 'p5': 0.0057
    })
    return coeffs


def fef2575_females(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fef2575_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fef2575_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fef2575_females, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.16446,-0.67863,6.88721,-20.52867,20.23557,-6.75218]
        ss_coeffs = [0.40065,-4.65780,13.88609,-16.73946,9.68189,-2.21069]
        ls_coeffs = [0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(1))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 1.2172, 'q1': -0.1781,
        'a0': -5.1682, 'a1': 1.4066, 'a2': -0.2618,
        'a3': -0.1244, 'a4': -0.0799, 'a5': -0.0398, 'a6': -0.0531,
        'p0': -2.2968, 'p1': 0.2847, 'p2': 0.1869,
        'p3': -0.0114, 'p4': -0.0473, 'p5': 0.0057
    })
    
    return coeffs

def fef75_males(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fef75_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fef75_males, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fef75_males, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [1.87151,-16.48985,65.03691,-124.50361,107.14445,-34.26999]
        ss_coeffs = [0.28423,-4.03252,14.19341,-19.84831,13.38018,-3.57653]
        ls_coeffs = [0]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(1))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 0.6289, 'q1': -0.1342,
        'a0': -9.1978, 'a1': 2.1023, 'a2': -0.3656,
        'a3': -0.2879, 'a4': 0.1142, 'a5': 0.1364, 'a6': -0.0272,
        'p0': -1.5769, 'p1': 0.1959, 'p2': 0.1205,
        'p3': -0.2037, 'p4': -0.1664, 'p5': -0.0381
    })
    
    return coeffs

def fef75_females(age: float, height: float, ethnicity: str) -> Dict[str, float]:
    """Calculate FEV1 coefficients for females."""
    coeffs = {}
    
    if 3 <= age < 25:
        # Use spline interpolation for ages 3-25
        coeffs['mspline'] = float(interp1d(ages[:88], mspline_fef75_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['sspline'] = float(interp1d(ages[:88], sspline_fef75_females, kind='linear', fill_value='extrapolate')(age))
        coeffs['lspline'] = float(interp1d(ages[:88], lspline_fef75_females, kind='linear', fill_value='extrapolate')(age))
    else:
        # Adult (age >= 25): use polynomial coefficients
        ms_coeffs = [0.80004,-6.22951,30.77091,-70.83995,66.98402,-22.62309]
        ss_coeffs = [-2.50900,18.41351,-32.03797,40.30778,-28.63753,8.43383]
        ls_coeffs = [-0.67878,11.93101,-74.67812,241.12565,-443.14770,466.23860,-261.94216,61.02742]
        
        age_scaled = age / 100
        coeffs['mspline'] = sum(ms_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['sspline'] = sum(ss_coeffs[i] * (age_scaled ** i) for i in range(6))
        coeffs['lspline'] = sum(ls_coeffs[i] * (age_scaled ** i) for i in range(8))
    
    # Common coefficients for all ages
    coeffs.update({
        'q0': 0.7088, 'q1': -0.1462,
        'a0': -8.2711, 'a1': 2.0092, 'a2': -0.5252,
        'a3': -0.3004, 'a4': 0.0496, 'a5': 0.0704, 'a6': -0.0272,
        'p0': 4.1543, 'p1': -1.8154, 'p2': 0.1330,
        'p3': -0.1515, 'p4': -0.0367, 'p5': -0.0381
    })
    
    return coeffs

def main():
    sample_data = {
        'Age': [25],
        'Height_cm': [155],
        'Gender': ['female'],
        'Ethnicity': ['South East Asian']
    }
    df = pd.DataFrame(sample_data)

    results = []
    for _, row in df.iterrows():
        age = row['Age']
        height = row['Height_cm']
        gender = row['Gender']
        ethnicity = row['Ethnicity']
        
        if gender.strip().lower() == 'male':
            fev1_coeffs = fev1_males(age, height, ethnicity)
            fvc_coeffs = fvc_males(age, height, ethnicity)
            fev1fvc_coeffs = fev1fvc_males(age, height, ethnicity)
            fef2575_coeffs = fef2575_males(age, height, ethnicity)
            fef75_coeffs = fef75_males(age, height, ethnicity)
        else:
            fev1_coeffs = fev1_females(age, height, ethnicity)
            fvc_coeffs = fvc_females(age, height, ethnicity)
            fev1fvc_coeffs = fev1fvc_females(age, height, ethnicity)
            fef2575_coeffs = fef2575_females(age, height, ethnicity)
            fef75_coeffs = fef75_females(age, height, ethnicity)
        
        fev1_values = equations(age, height, ethnicity, fev1_coeffs)
        fvc_values = equations(age, height, ethnicity, fvc_coeffs)
        fev1fvc_values = equations(age, height, ethnicity, fev1fvc_coeffs)
        fef2575_values = equations(age, height, ethnicity, fef2575_coeffs)
        fef75_values = equations(age, height, ethnicity, fef75_coeffs)
        
        entry = {
            'Age': age, 'Height_cm': height, 'Gender': gender, 'Ethnicity': ethnicity,
            'FEV1_pred': float(fev1_values['M']), 'FEV1_LLN': fev1_values['LLN'],
            'FVC_pred': fvc_values['M'], 'FVC_LLN': fvc_values['LLN'],
            'FEV1FVC_pred': fev1fvc_values['M'], 'FEV1FVC_LLN': fev1fvc_values['LLN'],
            'FEF2575_pred': fef2575_values['M'], 'FEF2575_LLN': fef2575_values['LLN'],
            'FEF75_pred': fef75_values['M'], 'FEF75_LLN': fef75_values['LLN']
        }
        results.append(entry)
    
    out_df = pd.DataFrame(results)

    print(out_df.to_string()) 

if __name__ == "__main__":
    main()